<!DOCTYPE html>
<html>

<head>
    <title>Multi Stream</title>
    <meta charset="UTF-8" />
</head>

<body>
    <h2> 4 видеопотока (LL-HLS)</h2>
    <button onclick="startAll()">Старт всех видеопотоков</button>

    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        <video id="video1" width="320" height="240" muted playsinline autoplay></video>
        <video id="video2" width="320" height="240" muted playsinline autoplay></video>
        <video id="video3" width="320" height="240" muted playsinline autoplay></video>
        <video id="video4" width="320" height="240" muted playsinline autoplay></video>
    </div>

    <script>
        function setupHLS(videoId, streamPath) {
            const video = document.getElementById(videoId);
            if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = `${streamPath}/index.m3u8`;
            } else {
                const hls = new Hls({ lowLatencyMode: true });
                hls.loadSource(`${streamPath}/index.m3u8`);
                hls.attachMedia(video);
            }
        }

        function startAll() {
            if (typeof Hls === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/hls.js@latest';
                script.onload = () => {
                    setupHLS('video1', '/stream1');
                    setupHLS('video2', '/stream2');
                    setupHLS('video3', '/stream3');
                    setupHLS('video4', '/stream4');
                };
                document.head.appendChild(script);
            } else {
                setupHLS('video1', '/stream1');
                setupHLS('video2', '/stream2');
                setupHLS('video3', '/stream3');
                setupHLS('video4', '/stream4');
            }
        }
    </script>
</body>

</html>